<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Реестр Hermes-Ural</title>
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/admin.css" />
    <link rel="stylesheet" href="css/registry-common.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Стили для модульной системы -->
    <style>
      .module-loading {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.95);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        font-family: Arial, sans-serif;
      }

      .loading-spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid #3498db;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .hidden {
        display: none !important;
      }

      .module-status {
        color: #666;
        font-size: 14px;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <!-- Индикатор загрузки модульной системы -->
    <div id="module-loading" class="module-loading">
      <div class="loading-spinner"></div>
      <div class="module-status">Загрузка модульной системы...</div>
    </div>

    <div class="app-container">
      <!-- Главный экран -->
      <div class="welcome-screen">
        <div class="welcome-header">
          <div class="logo-container">
            <i class="fas fa-wrench logo-icon"></i>
            <h1 class="logo-text">Hermes-Ural</h1>
          </div>
          <p class="welcome-subtitle">
            Система управления сварочными реестрами
          </p>
        </div>

        <div class="selection-card">
          <div class="selection-header">
            <i class="fas fa-database selection-icon"></i>
            <h2>Выберите реестр</h2>
            <p>Для просмотра и управления данными</p>
          </div>

          <div class="selection-options">
            <select id="weldingType" class="modern-select">
              <option value="">-- Выберите реестр --</option>
              <option value="resWire">Реестр сварочной проволоки</option>
              <option value="resTP">Реестр технологии сварки</option>
              <option value="resWeld">Реестр сварщиков</option>
              <option value="resSpec">
                Реестр специалистов сварочного производства
              </option>
            </select>

            <button id="confirmBtn" class="primary-btn">
              <i class="fas fa-arrow-right btn-icon"></i>
              Перейти к реестру
            </button>
          </div>

          <div class="admin-access">
            <p>Нужно управление данными?</p>
            <button
              onclick="window.location.href='admin.html'"
              class="admin-btn"
            >
              <i class="fas fa-cog btn-icon"></i>
              Админ панель
            </button>
          </div>
        </div>

        <div class="footer-info">
          <div class="info-item">
            <i class="fas fa-shield-alt"></i>
            <span>Безопасное хранение данных</span>
          </div>
          <div class="info-item">
            <i class="fas fa-sync-alt"></i>
            <span>Актуальные сертификаты</span>
          </div>
          <div class="info-item">
            <i class="fas fa-mobile-alt"></i>
            <span>Адаптивный интерфейс</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Подключение модульной системы -->
    <script type="module">
      // Инициализация модульной системы
      console.log("Инициализация модульной системы Hermes-Ural...");

      // Функция загрузки модуля с обработкой ошибок
      async function loadModule(path, name) {
        try {
          console.log(`Загрузка модуля: ${name}`);
          const module = await import(path);
          console.log(`Модуль ${name} загружен успешно`);
          return module;
        } catch (error) {
          console.error(`Ошибка загрузки модуля ${name}:`, error);
          throw new Error(
            `Не удалось загрузить модуль ${name}: ${error.message}`
          );
        }
      }

      // Функция обновления статуса загрузки
      function updateLoadingStatus(message) {
        const statusElement = document.querySelector(".module-status");
        if (statusElement) {
          statusElement.textContent = message;
        }
      }

      // Функция скрытия экрана загрузки
      function hideLoadingScreen() {
        const loadingElement = document.getElementById("module-loading");
        if (loadingElement) {
          loadingElement.style.opacity = "0";
          setTimeout(() => {
            loadingElement.style.display = "none";
          }, 500);
        }
      }

      try {
        // Последовательная загрузка модулей
        updateLoadingStatus("Загрузка базовых модулей...");
        await loadModule("./js/modules/common.js", "common");

        updateLoadingStatus("Загрузка серверных модулей...");
        await loadModule("./js/modules/file-server.js", "file-server");

        updateLoadingStatus("Загрузка системы резервных копий...");
        await loadModule("./js/modules/backup-manager.js", "backup-manager");

        updateLoadingStatus("Загрузка модуля администрирования...");
        await loadModule("./js/modules/admin.js", "admin");

        updateLoadingStatus("Загрузка модулей данных...");
        await loadModule("./js/modules/wire.js", "wire");
        await loadModule("./js/modules/welders.js", "welders");
        await loadModule("./js/modules/specialists.js", "specialists");
        await loadModule("./js/modules/techprocess.js", "techprocess");

        updateLoadingStatus("Запуск приложения...");
        const appModule = await loadModule("./js/modules/app.js", "app");

        console.log("Все модули загружены успешно");
        updateLoadingStatus("Система готова к работе");

        // Скрываем экран загрузки
        setTimeout(hideLoadingScreen, 1000);
      } catch (error) {
        console.error("Критическая ошибка инициализации:", error);
        updateLoadingStatus("Ошибка загрузки: " + error.message);

        // Показываем кнопку перезагрузки
        const loadingElement = document.getElementById("module-loading");
        if (loadingElement) {
          loadingElement.innerHTML = `
            <div style="text-align: center; color: #e74c3c;">
              <i class="fas fa-exclamation-triangle" style="font-size: 48px; margin-bottom: 20px;"></i>
              <h3>Ошибка загрузки системы</h3>
              <p style="margin: 10px 0;">${error.message}</p>
              <button onclick="location.reload()" class="btn btn-primary" style="margin-top: 20px;">
                <i class="fas fa-refresh"></i> Перезагрузить страницу
              </button>
            </div>
          `;
        }
      }
    </script>

    <!-- Fallback для обратной совместимости -->
    <script src="js/registry-common.js"></script>
    <script src="app.js"></script>
  </body>
</html>
